# Install httpd and createrepo_c
dnf install -y httpd createrepo_c

# Create HTML Directory for the repos
mkdir -p /var/www/html/repo

# Find repo names
dnf repolist

## rhel-9-for-x86_64-appstream-rpms                         Red Hat Enterprise Linux 9 for x86_64 - AppStream (RPMs)
## rhel-9-for-x86_64-baseos-rpms                            Red Hat Enterprise Linux 9 for x86_64 - BaseOS (RPMs)

# Run reposync using the names just found, sending it to the html directory created
dnf reposync --repo rhel-9-for-x86_64-appstream-rpms -p /var/www/html/repo --download-metadata --downloadcomps
dnf reposync --repo rhel-9-for-x86_64-baseos-rpms -p /var/www/html/repo --download-metadata --downloadcomps

# Index and create the repos
createrepo_c -v /var/www/html/repo/rhel-9-for-x86_64-appstream-rpms/ -g comps.xml
createrepo_c -v /var/www/html/repo/rhel-9-for-x86_64-baseos-rpms/ -g comps.xml

# Enable and start httpd
systemctl enable --now httpd

# Add port 80 / httpd to the firewalld
firewall-cmd --add-service=http --permanent
firewall-cmd --reload

### Updating the Repos ###
dnf reposync --repo rhel-9-for-x86_64-appstream-rpms -p /var/www/html/repo --download-metadata --downloadcomps --delete
dnf reposync --repo rhel-9-for-x86_64-baseos-rpms -p /var/www/html/repo --download-metadata --downloadcomps --delete
createrepo_c -v /var/www/html/repo/rhel-9-for-x86_64-appstream-rpms/ -g comps.xml
createrepo_c -v /var/www/html/repo/rhel-9-for-x86_64-baseos-rpms/ -g comps.xml
